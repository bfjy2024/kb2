<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>2025-2026-1è¯¾ç¨‹è¡¨ï¼ˆæ‰‹æœºä¼˜åŒ–ç‰ˆï¼‰</title>
    <style>
        :root {
            --class1: #e8f4ff; --class2: #f0f8ff;
            --class3: #f5f3ff; --class4: #fff0f5;
            --class5: #e6ffe6; --class6: #fff3cd;
            --active-week: #007AFF;
            --primary-color: #2196F3;
            --danger-color: #c62828;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            background: #f5f5f7;
            padding: 15px;
            max-width: 1200px;
            margin: 0 auto;
        }

        /* æ‰‹æœºç«¯æ ¸å¿ƒæ ·å¼ */
        @media (max-width: 768px) {
            .week-nav {
                flex-direction: column;
                gap: 8px;
                margin-bottom: 15px;
            }

            .week-nav button {
                width: 100%;
                padding: 10px 12px;
                font-size: 14px;
                white-space: normal;
            }

            .week-card {
                padding: 12px;
                border-radius: 12px;
                margin-bottom: 15px;
            }

            .week-header {
                margin-bottom: 8px;
            }

            .week-header h3 {
                font-size: 16px;
            }

            .week-header .date-range {
                font-size: 12px;
                color: #666;
            }

            table {
                display: block;
                overflow-x: auto;
                margin-top: 10px;
            }

            th, td {
                padding: 6px;
                font-size: 14px;
                min-width: 80px; /* ç¡®ä¿å•å…ƒæ ¼æœ‰è¶³å¤Ÿå®½åº¦æ˜¾ç¤º2ä¸ªå­—ç¬¦ */
            }

            .time-col {
                width: 60px;
                font-size: 12px;
                font-weight: 500;
                color: #666;
            }

            .course-content {
                padding: 10px;
            }

            .course-name {
                font-size: 14px;
                line-height: 1.5;
                margin-bottom: 8px;
                color: var(--primary-color);
                font-weight: 600;
            }

            .course-detail {
                font-size: 12px;
                line-height: 1.5;
                color: #666;
            }

            .holiday-mark {
                right: 2px;
                bottom: 2px;
            }

            .holiday-text {
                font-size: 12px;
                padding: 1px 4px;
            }
        }
        
        /* é€šç”¨æ ·å¼ */
        .holiday-mark {
            position: absolute;
            right: 4px;
            bottom: 4px;
            z-index: 2;
            display: flex;
            align-items: center;
        }
        
        .holiday-text {
            background: rgba(255, 235, 59, 0.9);
            color: var(--danger-color);
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 13px;
            font-weight: 500;
            box-shadow: 0 1px 2px rgba(0,0,0,0.1);
        }
        
        .holiday-line {
            width: 12px;
            height: 2px;
            background: var(--danger-color);
            margin-left: 4px;
            opacity: 0.6;
        }
        
        td {
            position: relative;
            min-height: 70px; /* ç¡®ä¿å•å…ƒæ ¼æœ‰è¶³å¤Ÿé«˜åº¦æ˜¾ç¤ºå¤šè¡Œå†…å®¹ */
            vertical-align: top; /* å†…å®¹é¡¶éƒ¨å¯¹é½ï¼Œé¿å…ç©ºå•å…ƒæ ¼æ˜¾å¾—æ‹¥æŒ¤ */
        }
        
        .week-nav {
            display: flex;
            gap: 8px;
            margin-top: 15px;
            flex-wrap: wrap;
        }

        .week-nav button {
            padding: 8px 12px;
            border-radius: 8px;
            border: 1px solid #e3e3e8;
            background: white;
            cursor: pointer;
            transition: 0.2s;
        }

        .week-nav button.active {
            background: var(--active-week);
            color: white;
            border-color: var(--active-week);
        }

        .week-card {
            background: white;
            border-radius: 18px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
            padding: 20px;
            margin-bottom: 20px;
        }

        .week-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .week-header h3 {
            font-size: 18px;
            margin: 0;
        }

        .week-header .date-range {
            font-size: 14px;
            color: #666;
        }

        .current-course {
            background: #fff8e1 !important;
            box-shadow: inset 0 0 0 2px #ffd54f;
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {
            0%, 100% { box-shadow: inset 0 0 0 2px #ffd54f; }
            50% { box-shadow: inset 0 0 0 4px #ffd54f; }
        }
    </style>
</head>
<body>
    <div id="timetables"></div>
    <div class="week-nav" id="weekNav"></div>

<script>
// åŸºç¡€æ•°æ®ï¼ˆæŒ‰Excelæ›´æ–°ï¼‰
const startDate = new Date(2025, 8, 8); // 2025-09-08ï¼ˆå­¦æœŸå¼€å§‹æ—¥æœŸï¼‰
const holidays = [
    { date: '2025-09-27', name: 'ä¸­ç§‹' },
    { date: '2025-10-01', name: 'å›½åº†' },
    { date: '2025-10-02', name: 'å›½åº†' },
    { date: '2025-10-03', name: 'å›½åº†' },
    { date: '2025-10-04', name: 'å›½åº†' },
    { date: '2025-10-05', name: 'å›½åº†' },
    { date: '2025-10-06', name: 'å›½åº†' },
    { date: '2025-10-07', name: 'å›½åº†' }
];
const courses = [
    // æ˜ŸæœŸä¸€
    { name: 'çº¿æ€§ä»£æ•°', weeks: '1-16', time: '9-10', day: 1, classroom: '5-604', class: 'ç½‘ç»œ2ç­', color: 'var(--class2)' },
    // æ˜ŸæœŸäºŒ
    { name: 'çº¿æ€§ä»£æ•°', weeks: '1-16', time: '1-2', day: 2, classroom: 'æ¾1-608', class: 'æ–°èƒ½æº1ç­', color: 'var(--class1)' },
    { name: 'çº¿æ€§ä»£æ•°', weeks: '1-16', time: '3-4', day: 2, classroom: 'æ¾1-501', class: 'æ–°èƒ½æº2ç­', color: 'var(--class2)' },
    // æ˜ŸæœŸå››
    { name: 'çº¿æ€§ä»£æ•°', weeks: '1-12,15-18', time: '3-4', day: 4, classroom: 'æ¾1-506', class: 'ç”µä¿¡4ç­', color: 'var(--class3)' },
    { name: 'çº¿æ€§ä»£æ•°', weeks: '1-16', time: '5-6', day: 4, classroom: 'æ¾1-608', class: 'æ–°èƒ½æº3ç­', color: 'var(--class4)' },
    { name: 'çº¿æ€§ä»£æ•°', weeks: '1-13,16-18', time: '7-8', day: 4, classroom: 'æ¾3-602', class: 'å¤§æ•°æ®2ç­', color: 'var(--class5)' },
    // æ˜ŸæœŸäº”
    { name: 'çº¿æ€§ä»£æ•°', weeks: '1-12,15-18', time: '1-2', day: 5, classroom: 'æ¾1-608', class: 'ç”µä¿¡3ç­', color: 'var(--class6)' }
];

// è¾…åŠ©å‡½æ•°ï¼šå°†å­—ç¬¦ä¸²æ‹†åˆ†ä¸ºæ¯2ä¸ªå­—ç¬¦ä¸€è¡Œ
function splitEveryTwoChars(str) {
    if (!str) return '';
    return str.match(/.{1,2}/g).join('<br>');
}

// åˆå§‹åŒ–è¯¾ç¨‹è¡¨
function init() {
    // ç”Ÿæˆå‘¨è¯¾è¡¨
    const container = document.getElementById('timetables');
    for (let week = 1; week <= 20; week++) {
        const card = document.createElement('div');
        card.className = 'week-card';
        card.id = `week${week}`;
        card.style.display = 'none';
        card.innerHTML = `
            <div class="week-header">
                <h3>ç¬¬ ${week} å‘¨</h3>
                <div class="date-range">(${getDateRange(week)})</div>
            </div>
            ${renderTable(week)}
        `;
        container.appendChild(card);
    }

    // ç”Ÿæˆå‘¨å¯¼èˆª
    const nav = document.getElementById('weekNav');
    for (let week = 1; week <= 20; week++) {
        const btn = document.createElement('button');
        btn.textContent = `ç¬¬${week}å‘¨`;
        btn.onclick = () => showWeek(week);
        nav.appendChild(btn);
    }

    // æ˜¾ç¤ºå½“å‰å‘¨
    showWeek(getCurrentWeek());
    setInterval(highlightCurrent, 60000);
    highlightCurrent();
}

// æ˜¾ç¤ºæŒ‡å®šå‘¨
function showWeek(week) {
    // æ›´æ–°å¯¼èˆªæ¿€æ´»çŠ¶æ€
    document.querySelectorAll('.week-nav button').forEach(btn => {
        btn.classList.toggle('active', btn.textContent === `ç¬¬${week}å‘¨`);
    });
    // æ˜¾ç¤ºå¯¹åº”å‘¨è¯¾è¡¨
    document.querySelectorAll('.week-card').forEach(card => {
        card.style.display = card.id === `week${week}` ? 'block' : 'none';
    });
}

// æ¸²æŸ“è¯¾ç¨‹è¡¨
function renderTable(week) {
    const timeSlots = [
        { time: '1-2', period: 'ä¸Šåˆ' },
        { time: '3-4', period: 'ä¸Šåˆ' },
        { time: '5-6', period: 'ä¸‹åˆ' },
        { time: '7-8', period: 'ä¸‹åˆ' },
        { time: '9-10', period: 'æ™šä¸Š' } // åŒ…å«æ™šä¸ŠèŠ‚æ¬¡
    ];

    // ç”Ÿæˆè¡¨å¤´ï¼ˆæ˜ŸæœŸ+æ—¥æœŸï¼‰
    const headerHtml = [1,2,3,4,5,6,7].map(day => {
        const dateStr = getDateStr(week, day);
        const holiday = checkHoliday(dateStr);
        return `
            <th>
                æ˜ŸæœŸ${['ä¸€','äºŒ','ä¸‰','å››','äº”','å…­','æ—¥'][day-1]}
                <div class="date-info">${dateStr}${holiday ? '<span class="holiday-icon">ğŸ‰</span>' : ''}</div>
            </th>
        `;
    }).join('');

    // ç”Ÿæˆè¡¨æ ¼å†…å®¹ï¼ˆèŠ‚æ¬¡+è¯¾ç¨‹ï¼‰
    const bodyHtml = timeSlots.map(slot => {
        const rowHtml = [1,2,3,4,5,6,7].map(day => {
            const dateStr = getDateStr(week, day);
            const holiday = checkHoliday(dateStr);
            // æŸ¥æ‰¾å½“å‰èŠ‚æ¬¡çš„è¯¾ç¨‹
            const course = courses.find(c => 
                checkWeek(week, c.weeks) && 
                c.day === day && 
                c.time === slot.time
            );
            // æ¸²æŸ“å•å…ƒæ ¼
            return `
                <td style="background:${course?.color || 'transparent'}">
                    ${course ? `
                        <div class="course-content">
                            <div class="course-name">${splitEveryTwoChars(course.name)}</div>
                            <div class="course-detail">
                                ${splitEveryTwoChars(course.classroom)}<br>
                                ${splitEveryTwoChars(course.class)}
                            </div>
                        </div>
                    ` : ''}
                    ${holiday ? `
                        <div class="holiday-mark">
                            <div class="holiday-text">${holiday}</div>
                            <div class="holiday-line"></div>
                        </div>
                    ` : ''}
                </td>
            `;
        }).join('');

        // æ¸²æŸ“è¡Œï¼ˆæ—¶é—´+è¯¾ç¨‹ï¼‰
        return `
            <tr>
                <td class="time-col">${slot.time}èŠ‚<br>${slot.period}</td>
                ${rowHtml}
            </tr>
        `;
    }).join('');

    // ç”Ÿæˆå®Œæ•´è¡¨æ ¼
    return `
        <table border="0" cellpadding="0" cellspacing="0">
            <tr>
                <th class="time-col">æ—¶é—´</th>
                ${headerHtml}
            </tr>
            ${bodyHtml}
        </table>
    `;
}

// è¾…åŠ©å‡½æ•°ï¼šæ£€æŸ¥å½“å‰å‘¨æ˜¯å¦åœ¨è¯¾ç¨‹å‘¨æ¬¡å†…
function checkWeek(currentWeek, weekRule) {
    // å¤„ç†"æ— "ï¼ˆå¦‚"1-17æ— 9"ï¼‰
    if (weekRule.includes('æ— ')) {
        const [range, exclude] = weekRule.split('æ— ');
        const [start, end] = range.split('-').map(Number);
        const excludeWeeks = exclude.split(',').map(Number);
        return currentWeek >= start && currentWeek <= end && !excludeWeeks.includes(currentWeek);
    }
    // å¤„ç†"å•"ï¼ˆå¦‚"1-15å•"ï¼‰
    if (weekRule.includes('å•')) {
        const [start, end] = weekRule.replace('å•','').split('-').map(Number);
        return currentWeek >= start && currentWeek <= end && currentWeek % 2 === 1;
    }
    // å¤„ç†"åŒ"ï¼ˆå¦‚"2-16åŒ"ï¼‰
    if (weekRule.includes('åŒ')) {
        const [start, end] = weekRule.replace('åŒ','').split('-').map(Number);
        return currentWeek >= start && currentWeek <= end && currentWeek % 2 === 0;
    }
    // å¤„ç†é€—å·åˆ†éš”ï¼ˆå¦‚"1-12,15-18"ï¼‰
    const ranges = weekRule.split(',').map(r => r.split('-').map(Number));
    return ranges.some(([s, e]) => currentWeek >= s && currentWeek <= e);
}

// è¾…åŠ©å‡½æ•°ï¼šæ£€æŸ¥æ—¥æœŸæ˜¯å¦ä¸ºèŠ‚å‡æ—¥
function checkHoliday(dateStr) {
    const [month, day] = dateStr.split('/');
    const fullDate = `2025-${month.padStart(2,'0')}-${day.padStart(2,'0')}`;
    return holidays.find(h => h.date === fullDate)?.name || null;
}

// è¾…åŠ©å‡½æ•°ï¼šè·å–å½“å‰å‘¨
function getCurrentWeek() {
    const now = new Date();
    const diffDays = Math.floor((now - startDate) / (1000*60*60*24));
    const currentWeek = Math.floor(diffDays / 7) + 1;
    return Math.max(1, Math.min(20, currentWeek));
}

// è¾…åŠ©å‡½æ•°ï¼šè·å–æŒ‡å®šå‘¨+æ˜ŸæœŸçš„æ—¥æœŸï¼ˆå¦‚ç¬¬1å‘¨æ˜ŸæœŸä¸€â†’2025-09-08ï¼‰
function getDateStr(week, day) {
    const date = new Date(startDate);
    date.setDate(date.getDate() + (week-1)*7 + (day-1));
    return `${date.getMonth()+1}/${date.getDate()}`;
}

// è¾…åŠ©å‡½æ•°ï¼šè·å–æŒ‡å®šå‘¨çš„æ—¥æœŸèŒƒå›´ï¼ˆå¦‚ç¬¬1å‘¨â†’9/8 - 9/12ï¼‰
function getDateRange(week) {
    const start = new Date(startDate);
    start.setDate(start.getDate() + (week-1)*7);
    const end = new Date(start);
    end.setDate(start.getDate() + 4); // å‘¨ä¸€åˆ°å‘¨äº”
    return `${start.getMonth()+1}/${start.getDate()} - ${end.getMonth()+1}/${end.getDate()}`;
}

// è¾…åŠ©å‡½æ•°ï¼šé«˜äº®å½“å‰æ­£åœ¨ä¸Šçš„è¯¾ç¨‹
function highlightCurrent() {
    const now = new Date();
    const currentWeek = getCurrentWeek();
    const currentDay = now.getDay(); // 0=å‘¨æ—¥
    const currentHour = now.getHours();

    // æ¸…é™¤æ—§é«˜äº®
    document.querySelectorAll('.current-course').forEach(el => {
        el.classList.remove('current-course');
    });

    // å‘¨æœ«ä¸é«˜äº®
    if (currentDay === 0 || currentDay === 6) return;

    // åŒ¹é…å½“å‰èŠ‚æ¬¡
    let currentTimeSlot = '';
    if (currentHour >= 8 && currentHour < 10) currentTimeSlot = '1-2';
    else if (currentHour >= 10 && currentHour < 12) currentTimeSlot = '3-4';
    else if (currentHour >= 14 && currentHour < 16) currentTimeSlot = '5-6';
    else if (currentHour >= 16 && currentHour < 18) currentTimeSlot = '7-8';
    else if (currentHour >= 19 && currentHour < 21) currentTimeSlot = '9-10';

    // é«˜äº®å½“å‰è¯¾ç¨‹
    if (currentTimeSlot) {
        const table = document.querySelector(`#week${currentWeek} table`);
        if (table) {
            // æŸ¥æ‰¾å½“å‰èŠ‚æ¬¡çš„è¡Œï¼ˆæ—¶é—´åˆ—åŒ…å«å½“å‰èŠ‚æ¬¡ï¼‰
            const timeRow = table.querySelector(`tr:has(td.time-col:contains("${currentTimeSlot}èŠ‚"))`);
            if (timeRow) {
                // æŸ¥æ‰¾å½“å‰æ˜ŸæœŸçš„å•å…ƒæ ¼ï¼ˆcurrentDay=1â†’å‘¨ä¸€ï¼Œå¯¹åº”ç¬¬2åˆ—ï¼‰
                const courseCell = timeRow.children[currentDay];
                if (courseCell) {
                    courseCell.classList.add('current-course');
                }
            }
        }
    }
}

// å¯åŠ¨ç¨‹åº
document.addEventListener('DOMContentLoaded', init);
</script>
</body>
</html>
